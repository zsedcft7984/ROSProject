<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROS Topic Subscriber</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/roslibjs/1.1.0/roslib.min.js" integrity="sha512-x2Owc9WayRcRj80Znkau58shVfXN2OIX+gQAlrx6KPugZBKrIC6AwgEWQQCI06p2Q8RB4ilxD+y+1BdNd+1fQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        window.onload = function() {

            const ros_ip = "192.168.137.76";

            // ROS 연결 설정
            const ros = new ROSLIB.Ros({
                url: `ws://${ros_ip}:9090` // ROS WebSocket 서버 URL (로컬에서 실행 중인 ROS 마스터에 연결)
            });

            // 연결이 성공하면 로그 출력
            ros.on('connection', function() {
                console.log('Connected to ROS server');
            });

            // 연결이 실패하면 로그 출력
            ros.on('close', function() {
                console.log('Connection closed');
            });

            // 'voltage' 토픽 구독
            const voltageTopic = new ROSLIB.Topic({
                ros: ros,
                name: '/voltage', // 구독할 토픽 이름
                messageType: 'jetbotmini_msgs/Battery'
            });

            // 토픽 메시지 수신 시 동작
            voltageTopic.subscribe(function(message) {
                console.log('Received message: ' + message.data);
                document.getElementById('voltageDisplay').innerText = 'Voltage: ' + message.data; // p 태그에 값 출력
            });
        };
    </script>
</head>
<body>
    <h1>ROS Topic Subscriber</h1>
    <p id="voltageDisplay">Voltage: Waiting for data...</p>
    
    <!-- 실시간 이미지 스트리밍을 위한 이미지 태그 -->
    <h2>Live Video Stream</h2>
    <img id="videoStream" src="http://192.168.137.76:8080/stream?topic=/csi_cam_0/image_raw" width="640" height="480" alt="Live Video Stream">
</body>
</html>
